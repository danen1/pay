<!doctype html>
<!--
  使用说明（请阅读并按需修改）：
  1）把下面脚本中的 TARGET_URL 改为你的目标域（必须带 http/https 协议）。
     例如：const TARGET_URL = 'https://your-domain.com';
  2）微信/QQ 内置浏览器打开你的域名时，会在本页面内通过 iframe 显示目标域内容；
     外部浏览器（Safari/Chrome）打开，则自动跳转到目标域（保留路径与查询）。
  3）顶部提示文字、按钮文案都可以在下方 HTML 中自行修改；样式在 <style> 中。
  4）如果目标站点设置了 X-Frame-Options 或严格 CSP 禁止被嵌入，
     微信/QQ 内可能无法显示，这时会展示提示与“在浏览器中打开目标域”按钮。
-->
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title></title>
    <style>
      /* 最简样式，仅让 iframe 占满页面 */
      html, body { height: 100%; margin: 0; }
      .wrap { height: 100%; }
      iframe { width: 100%; height: 100%; border: 0; }
    </style>
    <script>
      // 唯一需要修改：设置你的目标域（必须带协议，例：https://example.com）
      // 只需改成你的域名即可，其他代码不需要动。
      const TARGET_URL = 'https://danen1.github.io/pay/';

      // UA 识别：判断是否为微信或 QQ 内置浏览器
      function isWeChat(ua) { return /MicroMessenger/i.test(ua); }
      function isQQ(ua) { return /(\bQQ\/|QQBrowser|MQQBrowser)/i.test(ua); }

      // 目标地址拼接：把当前访问的路径/查询/hash 保留到目标域
      function buildTargetUrl(currentUrl) {
        try {
          const base = new URL(TARGET_URL);
          const src = new URL(currentUrl);
          // 保留在你域名上的路径、查询、hash 到目标域
          return new URL(src.pathname + src.search + src.hash, base).toString();
        } catch (e) {
          return TARGET_URL;
        }
      }

      // 页面入口：根据 UA 决定是 iframe 展示还是外部浏览器跳转
      function init() {
        const ua = navigator.userAgent || '';
        const target = buildTargetUrl(location.href);
        const isWebView = isWeChat(ua) || isQQ(ua);

        if (!isWebView) {
          // 外部浏览器：直接跳转到目标域（保留路径与查询）
          location.replace(target);
          return;
        }

        // 微信/QQ webview：在当前域名下以 iframe 展示目标域
        const iframe = document.getElementById('proxy');
        iframe.src = target;
        // 如果 iframe 在一定时间内未成功加载（可能被目标站点禁止嵌入），则自动跳转到目标域
        let loaded = false;
        iframe.addEventListener('load', function() { loaded = true; });
        setTimeout(function() {
          if (!loaded) {
            location.replace(target);
          }
        }, 2000);
      }

      document.addEventListener('DOMContentLoaded', init);
    </script>
  </head>
  <body>
    <div class="wrap">
      <!-- 目标内容 iframe：在微信/QQ 内会加载目标域 -->
      <iframe id="proxy" title="目标内容"></iframe>
    </div>
  </body>
</html>