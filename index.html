<!doctype html>
<!--
  使用说明（请阅读并按需修改）：
  1）把下面脚本中的 TARGET_URL 改为你的目标域（必须带 http/https 协议）。
     例如：const TARGET_URL = 'https://your-domain.com';
  2）微信/QQ 内置浏览器打开你的域名时，会在本页面内通过 iframe 显示目标域内容；
     外部浏览器（Safari/Chrome）打开，则自动跳转到目标域（保留路径与查询）。
  3）顶部提示文字、按钮文案都可以在下方 HTML 中自行修改；样式在 <style> 中。
  4）如果目标站点设置了 X-Frame-Options 或严格 CSP 禁止被嵌入，
     微信/QQ 内可能无法显示，这时会展示提示与“在浏览器中打开目标域”按钮。
-->
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title></title>
    <style>
      /* 最简样式，仅让 iframe 占满页面 */
      html, body { height: 100%; margin: 0; }
      .wrap { height: 100%; }
      iframe { width: 100%; height: 100%; border: 0; }
      /* 开屏选择弹窗样式 */
      .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.55); display: none; align-items: center; justify-content: center; z-index: 9999; }
      .dialog { width: 92%; max-width: 420px; background: #fff; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.2); overflow: hidden; }
      .dialog-header { padding: 14px 16px; font-size: 16px; font-weight: 600; color: #111; border-bottom: 1px solid #eee; }
      .dialog-body { padding: 12px 16px; color: #333; font-size: 14px; }
      .dialog-actions { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 12px 16px; }
      .btn-row { position: relative; }
      .btn { display: block; width: 100%; padding: 12px 14px; border-radius: 10px; font-size: 15px; text-align: center; cursor: pointer; text-decoration: none; border: 1px solid #ddd; }
      .btn-primary { background: #2d6cdf; color: #fff; border-color: #2d6cdf; }
      .btn-outline { background: #fff; color: #2d6cdf; }
      .hint { margin-top: 6px; font-size: 12px; color: #666; }
      .question { position: absolute; top: 8px; right: 10px; width: 20px; height: 20px; border-radius: 50%; border: 1px solid #bbb; background: #fff; color: #666; font-weight: 700; font-size: 13px; line-height: 18px; text-align: center; cursor: pointer; }
      .tip { display: none; margin-top: 8px; font-size: 13px; color: #444; background: #f7f8fa; border: 1px solid #eee; border-radius: 8px; padding: 8px; }
      .tip.show { display: block; }
    </style>
    <script>
      // 唯一需要修改：设置你的目标域（必须带协议，例：https://example.com）
      // 只需改成你的域名即可，其他代码不需要动。
      const TARGET_URL = 'https://fb.qdd.ink';

      // UA 识别：判断是否为微信或 QQ 内置浏览器
      function isWeChat(ua) { return /MicroMessenger/i.test(ua); }
      function isQQ(ua) { return /(\bQQ\/|QQBrowser|MQQBrowser)/i.test(ua); }
      function isIOS(ua) { return /(iPhone|iPad|iPod)/i.test(ua); }
      function isAndroid(ua) { return /Android/i.test(ua); }

      // 目标地址拼接：仅保留当前访问的查询参数与 hash，不附加路径
      function buildTargetUrl(currentUrl) {
        try {
          const src = new URL(currentUrl);
          const u = new URL(TARGET_URL);
          // 仅同步查询与 hash，避免像 https://www.baidu.com/index.html 这类 404
          u.search = src.search;
          u.hash = src.hash;
          return u.toString();
        } catch (e) {
          return TARGET_URL;
        }
      }

      function startDirectFlow(target) {
        // 微信/QQ webview：在当前域名下以 iframe 展示目标域，失败后自动跳转
        const iframe = document.getElementById('proxy');
        iframe.src = target;
        let loaded = false;
        iframe.addEventListener('load', function() { loaded = true; });
        setTimeout(function() {
          if (!loaded) {
            location.replace(target);
          }
        }, 2000);
      }

      function openExternalFlow(target, ua) {
        // 尝试打开新窗口；在微信/QQ中通常仍在内置WebView，但便于用户触发“在浏览器打开”
        try { window.open(target, '_blank'); } catch (e) {}
      }

      // 页面入口：根据 UA 决定弹窗与行为
      function init() {
        const ua = navigator.userAgent || '';
        const target = buildTargetUrl(location.href);
        const isWebView = isWeChat(ua) || isQQ(ua);

        if (!isWebView) {
          // 外部浏览器：直接跳转到目标域（保留查询与hash）
          location.replace(target);
          return;
        }

        // WebView 环境：展示选择弹窗
        const overlay = document.getElementById('overlay');
        const osHint = document.getElementById('os-hint');
        overlay.style.display = 'flex';

        // 根据设备给出简短引导文案
        if (isIOS(ua)) {
          osHint.textContent = 'iOS：点击右上角 ···，选择“在Safari中打开”。';
        } else if (isAndroid(ua)) {
          osHint.textContent = 'Android：点击右上角 ···，选择“在浏览器中打开”（如Chrome）。';
        } else {
          osHint.textContent = '请使用右上角菜单选择在浏览器中打开。';
        }

        const btnDirect = document.getElementById('btn-direct');
        const btnExternal = document.getElementById('btn-external');
        const qDirect = document.getElementById('q-direct');
        const qExternal = document.getElementById('q-external');
        const tipDirect = document.getElementById('tip-direct');
        const tipExternal = document.getElementById('tip-external');

        // 设置每个按钮的提示内容
        tipDirect.textContent = '直连访问将在微信/QQ内尝试内嵌打开。若站点禁止嵌入，约2秒后自动跳转到目标地址。';
        if (isIOS(ua)) {
          tipExternal.textContent = 'iOS：点击右上角 ···，选择“在Safari中打开”。';
        } else if (isAndroid(ua)) {
          tipExternal.textContent = 'Android：点击右上角 ···，选择“在浏览器中打开”（如Chrome）。';
        } else {
          tipExternal.textContent = '请使用右上角菜单选择在浏览器中打开。';
        }

        // 点击问号，展开/收起对应提示
        qDirect.addEventListener('click', function() {
          tipDirect.classList.toggle('show');
        });
        qExternal.addEventListener('click', function() {
          tipExternal.classList.toggle('show');
        });

        btnDirect.addEventListener('click', function() {
          overlay.style.display = 'none';
          startDirectFlow(target);
        });
        btnExternal.addEventListener('click', function() {
          overlay.style.display = 'none';
          openExternalFlow(target, ua);
        });
      }

      document.addEventListener('DOMContentLoaded', init);
    </script>
  </head>
  <body>
    <!-- 开屏选择弹窗 -->
    <div id="overlay" class="overlay" role="dialog" aria-modal="true">
      <div class="dialog">
        <div class="dialog-header">选择访问方式</div>
        <div class="dialog-body">
          请选择：
          <div class="hint" id="os-hint"></div>
        </div>
        <div class="dialog-actions">
          <div class="btn-row">
            <button id="btn-direct" class="btn btn-primary" type="button">直连访问</button>
            <button id="q-direct" class="question" type="button" aria-label="直连访问说明">?</button>
            <div id="tip-direct" class="tip"></div>
          </div>
          <div class="btn-row">
            <button id="btn-external" class="btn btn-outline" type="button">在浏览器打开</button>
            <button id="q-external" class="question" type="button" aria-label="在浏览器打开说明">?</button>
            <div id="tip-external" class="tip"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="wrap">
      <!-- 目标内容 iframe：在微信/QQ 内会加载目标域（选择“直连访问”后启用） -->
      <iframe id="proxy" title="目标内容"></iframe>
    </div>
  </body>
</html>